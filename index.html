<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è€å©†ä¸“å±ç‚¹é¤ ğŸ’–</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#fff9fb;padding:15px;font-family:Arial,sans-serif}
.container{max-width:500px;margin:0 auto}
h1{text-align:center;color:#e63946;margin-bottom:20px}

/* ç®¡ç†å‘˜æŒ‰é’® */
#adminBtn{
  background:#7209b7;color:white;border:none;
  padding:10px;width:100%;border-radius:8px;margin-bottom:15px
}

/* ç®¡ç†é¢æ¿ */
.admin{
  background:#f8f0f3;padding:15px;border-radius:10px;margin-bottom:20px;display:none
}
.admin input, .admin button{
  width:100%;padding:10px;margin:5px 0;border-radius:8px;border:1px solid #ddd
}
.addBtn{background:#e63946;color:white}

/* èœå“ç®¡ç†åˆ—è¡¨ */
.manageItem{
  display:flex;align-items:center;background:white;padding:10px;border-radius:8px;margin:8px 0;gap:10px
}
.manageItem img{width:50px;height:50px;border-radius:4px;object-fit:cover}
.manageItem .info{flex:1}
.manageItem button{padding:5px;font-size:12px;border-radius:4px}
.edit{background:#4361ee;color:white}
.del{background:#d62828;color:white}

/* ç‚¹é¤èœå• */
.menu{
  display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px
}
.dish{
  background:white;border-radius:10px;overflow:hidden;
  box-shadow:0 2px 5px #00000010
}
.dish img{width:100%;height:120px;object-fit:cover}
.dish .name{padding:8px;text-align:center}
.dish .order{
  background:#ff4d6d;color:white;border:none;width:100%;padding:6px
}

/* è®¢å• */
.orderBox{
  background:#fff0f3;padding:15px;border-radius:10px;margin-top:20px
}
#orderList{margin:10px 0;padding:10px;background:white;border-radius:8px}
.orderBox button{
  padding:8px 15px;margin-right:5px;border:none;border-radius:6px;color:white
}
.orderBox button:nth-child(3){background:#27ae60}
.orderBox button:nth-child(4){background:#888}
</style>
</head>
<body>

<div class="container">
  <h1>è€å©†ä¸è‚‰å¤§äººç‚¹é¤ ğŸ’–</h1>
  <button id="adminBtn">è€å…¬ç®¡ç†åå°</button>

  <!-- ç®¡ç†åå° -->
  <div class="admin" id="admin">
    <input type="text" id="dishName" placeholder="è¯·è¾“å…¥èœå“åç§°">
    <input type="file" id="dishImg" accept="image/*" placeholder="é€‰æ‹©èœå“å›¾ç‰‡">
    <button class="addBtn" onclick="addDish()">æ·»åŠ èœå“</button>
    <div id="manageList"></div>
  </div>

  <!-- ç‚¹é¤èœå• -->
  <div class="menu" id="menu"></div>

  <!-- ç‚¹é¤ç»“æœ -->
  <div class="orderBox">
    <strong>è€å©†ç‚¹äº†ï¼š</strong>
    <div id="orderList">æš‚æ— ç‚¹é¤</div>
    <button onclick="submitOrder()">æäº¤ç‚¹é¤</button>
    <button onclick="clearOrder()">æ¸…ç©ºç‚¹é¤</button>
  </div>
</div>

<script>
// ========= æ ¸å¿ƒé…ç½®ï¼šæ›¿æ¢æˆä½ è‡ªå·±çš„ï¼ =========
const GIST_ID = "f28398a48a714ac98a56a8b708e09e70"       // æ›¿æ¢ä¸ºä½ çš„Gist IDï¼ˆæ¯”å¦‚ï¼š123456abcdef7890ï¼‰
const GIST_FILE = "dishes.json"   // å›ºå®šå€¼ï¼Œä¸ç”¨æ”¹
const TOKEN = "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"         // æ›¿æ¢ä¸ºä½ çš„GitHub Tokenï¼ˆæ¯”å¦‚ï¼šghp_8888888888888888ï¼‰
const ADMIN_PWD = "65158760"       // ç®¡ç†å‘˜å¯†ç ï¼Œå¯è‡ªè¡Œä¿®æ”¹

// å…¨å±€å˜é‡
let dishes = []  // èœå“åˆ—è¡¨
let order = []   // ç‚¹é¤åˆ—è¡¨

// ========= äº‘ç«¯æ•°æ®åŒæ­¥æ ¸å¿ƒå‡½æ•° =========
// ä»GiståŠ è½½èœå“
async function loadDishes() {
  try {
    // è¯·æ±‚Gistæ•°æ®
    const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
      headers: {
        "Authorization": `token ${TOKEN}`,
        "Accept": "application/vnd.github.v3+json"
      }
    });
    
    if (!response.ok) throw new Error("åŠ è½½èœå“å¤±è´¥");
    const gistData = await response.json();
    // è§£æèœå“æ•°æ®
    dishes = JSON.parse(gistData.files[GIST_FILE].content) || [];
  } catch (error) {
    console.log("åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°ç©ºåˆ—è¡¨ï¼š", error);
    dishes = [];
  }
  // æ¸²æŸ“é¡µé¢
  renderMenu();    // æ¸²æŸ“ç‚¹é¤èœå•ï¼ˆè€å©†çœ‹ï¼‰
  renderManage();  // æ¸²æŸ“ç®¡ç†åˆ—è¡¨ï¼ˆè€å…¬çœ‹ï¼‰
}

// ä¿å­˜èœå“åˆ°Gist
async function saveDishes() {
  try {
    const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
      method: "PATCH",
      headers: {
        "Authorization": `token ${TOKEN}`,
        "Content-Type": "application/json",
        "Accept": "application/vnd.github.v3+json"
      },
      body: JSON.stringify({
        files: {
          [GIST_FILE]: {
            content: JSON.stringify(dishes, null, 2)  // æ ¼å¼åŒ–JSONï¼Œæ–¹ä¾¿æŸ¥çœ‹
          }
        }
      })
    });
    
    if (!response.ok) throw new Error("ä¿å­˜èœå“å¤±è´¥");
    return true;
  } catch (error) {
    console.error("ä¿å­˜å¤±è´¥ï¼š", error);
    alert("åŒæ­¥å¤±è´¥ï¼è¯·æ£€æŸ¥Gist IDå’ŒTokenæ˜¯å¦æ­£ç¡®");
    return false;
  }
}

// ========= ç®¡ç†å‘˜åŠŸèƒ½ =========
// æ˜¾ç¤º/éšè—ç®¡ç†åå°
document.getElementById("adminBtn").onclick = () => {
  const adminPanel = document.getElementById("admin");
  if (adminPanel.style.display === "block") {
    adminPanel.style.display = "none";
    return;
  }
  // å¯†ç éªŒè¯
  const inputPwd = prompt("è¯·è¾“å…¥è€å…¬ä¸“å±å¯†ç ï¼š");
  if (inputPwd === ADMIN_PWD) {
    adminPanel.style.display = "block";
    loadDishes(); // åŠ è½½èœå“åˆ—è¡¨
  } else if (inputPwd !== null) {
    alert("å¯†ç é”™è¯¯å•¦ï½");
  }
};

// æ·»åŠ æ–°èœå“
async function addDish() {
  const nameInput = document.getElementById("dishName");
  const imgInput = document.getElementById("dishImg");
  
  // éªŒè¯è¾“å…¥
  const dishName = nameInput.value.trim();
  const dishFile = imgInput.files[0];
  if (!dishName) return alert("èœåä¸èƒ½ä¸ºç©ºå“¦ï½");
  if (!dishFile) return alert("è¯·é€‰æ‹©èœå“å›¾ç‰‡ï½");

  // è½¬æ¢å›¾ç‰‡ä¸ºBase64
  const reader = new FileReader();
  reader.onload = async (e) => {
    // æ·»åŠ æ–°èœå“
    dishes.push({
      name: dishName,
      img: e.target.result  // Base64å›¾ç‰‡åœ°å€
    });
    // ä¿å­˜åˆ°äº‘ç«¯
    const saveSuccess = await saveDishes();
    if (saveSuccess) {
      // é‡ç½®è¡¨å•
      nameInput.value = "";
      imgInput.value = "";
      // é‡æ–°åŠ è½½æ¸²æŸ“
      loadDishes();
      alert(`âœ… èœå“ã€${dishName}ã€‘æ·»åŠ æˆåŠŸï¼`);
    }
  };
  reader.readAsDataURL(dishFile);
}

// ä¿®æ”¹èœå“åç§°
async function editDish(index) {
  const oldName = dishes[index].name;
  const newName = prompt(`ä¿®æ”¹ã€${oldName}ã€‘çš„åç§°ï¼š`, oldName);
  
  if (newName === null) return; // å–æ¶ˆæ“ä½œ
  if (newName.trim() === "") return alert("èœåä¸èƒ½ä¸ºç©ºï½");
  
  dishes[index].name = newName.trim();
  const saveSuccess = await saveDishes();
  if (saveSuccess) {
    loadDishes();
    alert(`âœ… èœå“åç§°æ”¹ä¸ºã€${newName}ã€‘ï¼`);
  }
}

// åˆ é™¤èœå“
async function delDish(index) {
  const dishName = dishes[index].name;
  if (!confirm(`ç¡®å®šåˆ é™¤ã€${dishName}ã€‘å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï½`)) return;
  
  dishes.splice(index, 1); // åˆ é™¤å¯¹åº”èœå“
  const saveSuccess = await saveDishes();
  if (saveSuccess) {
    loadDishes();
    alert(`âŒ èœå“ã€${dishName}ã€‘å·²åˆ é™¤ï¼`);
  }
}

// ========= ç‚¹é¤åŠŸèƒ½ =========
// é€‰æ‹©èœå“ï¼ˆè€å©†ç‚¹é¤ï¼‰
function orderDish(index) {
  const dishName = dishes[index].name;
  order.push(dishName);
  renderOrder(); // æ›´æ–°ç‚¹é¤åˆ—è¡¨
  alert(`âœ… å·²ç‚¹ã€${dishName}ã€‘ï¼`);
}

// æ¸²æŸ“ç‚¹é¤åˆ—è¡¨
function renderOrder() {
  const orderEl = document.getElementById("orderList");
  if (order.length === 0) {
    orderEl.textContent = "æš‚æ— ç‚¹é¤ï¼Œå¿«æ¥é€‰å¥½åƒçš„ğŸ˜œ";
  } else {
    orderEl.textContent = order.join("ã€");
  }
}

// æäº¤ç‚¹é¤
function submitOrder() {
  if (order.length === 0) return alert("è¿˜æ²¡ç‚¹èœå“å“¦ï½");
  const orderText = "è€å©†ç‚¹é¤ï¼š\n" + order.join("ã€");
  // å¤åˆ¶åˆ°å‰ªè´´æ¿
  navigator.clipboard.writeText(orderText).then(() => {
    alert(`âœ… ç‚¹é¤æˆåŠŸï¼\n${orderText}\nï¼ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¿«å»å‘ç»™è€å…¬å§ï½ï¼‰`);
    clearOrder(); // æ¸…ç©ºç‚¹é¤
  }).catch(() => {
    alert(`âœ… ç‚¹é¤æˆåŠŸï¼\n${orderText}\nï¼ˆå¤åˆ¶å¤±è´¥ï¼Œæ‰‹åŠ¨å‘ç»™è€å…¬å§ï½ï¼‰`);
  });
}

// æ¸…ç©ºç‚¹é¤
function clearOrder() {
  order = [];
  renderOrder();
  alert("âœ… ç‚¹é¤è½¦å·²æ¸…ç©ºï¼");
}

// ========= é¡µé¢æ¸²æŸ“ =========
// æ¸²æŸ“ç‚¹é¤èœå•ï¼ˆè€å©†çœ‹åˆ°çš„ï¼‰
function renderMenu() {
  const menuEl = document.getElementById("menu");
  if (dishes.length === 0) {
    menuEl.innerHTML = `<div style="text-align:center; width:100%; padding:50px; color:#888;">è€å…¬è¿˜æ²¡æ·»åŠ èœå“å“¦ï½</div>`;
    return;
  }
  
  menuEl.innerHTML = "";
  dishes.forEach((dish, index) => {
    menuEl.innerHTML += `
      <div class="dish">
        <img src="${dish.img}" alt="${dish.name}">
        <div class="name">${dish.name}</div>
        <button class="order" onclick="orderDish(${index})">æˆ‘è¦ç‚¹è¿™ä¸ªğŸ˜‹</button>
      </div>
    `;
  });
}

// æ¸²æŸ“ç®¡ç†åˆ—è¡¨ï¼ˆè€å…¬çœ‹åˆ°çš„ï¼‰
function renderManage() {
  const manageEl = document.getElementById("manageList");
  if (dishes.length === 0) {
    manageEl.innerHTML = `<div style="text-align:center; color:#888; padding:10px;">æš‚æ— èœå“ï¼Œæ·»åŠ ç¬¬ä¸€ä¸ªå§ï½</div>`;
    return;
  }
  
  manageEl.innerHTML = "";
  dishes.forEach((dish, index) => {
    manageEl.innerHTML += `
      <div class="manageItem">
        <img src="${dish.img}" alt="${dish.name}">
        <div class="info">${dish.name}</div>
        <button class="edit" onclick="editDish(${index})">æ”¹åå­—</button>
        <button class="del" onclick="delDish(${index})">åˆ é™¤</button>
      </div>
    `;
  });
}

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
window.onload = () => {
  loadDishes(); // åŠ è½½èœå“
  renderOrder(); // åˆå§‹åŒ–ç‚¹é¤åˆ—è¡¨
};
</script>
</body>
</html>











