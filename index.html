<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è€å©†ç‚¹é¤ ğŸ’–</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#fff9fb;margin:0;padding:15px;font-family:Arial,sans-serif}
.container{max-width:500px;margin:0 auto}
h1{text-align:center;color:#e63946;margin-bottom:20px}
/* ç®¡ç†å‘˜æ ·å¼ */
#showAdmin{background:#7209b7;color:white;border:none;padding:10px 20px;border-radius:8px;width:100%;margin-bottom:15px}
.admin{background:#f8f0f3;padding:15px;border-radius:10px;margin-bottom:20px;display:none}
.admin-upload{margin-bottom:15px;padding-bottom:15px;border-bottom:1px solid #ffccd5}
.admin input,.admin button{width:100%;margin:5px 0;padding:10px;border:1px solid #ddd;border-radius:8px}
.admin-btn{background:#e63946;color:white;border:none;padding:10px;border-radius:8px;cursor:pointer}
/* èœå“ç®¡ç†åˆ—è¡¨ */
.admin-list{margin-top:15px}
.admin-list h3{color:#e63946;margin-bottom:10px}
.dish-item{display:flex;align-items:center;background:white;padding:10px;border-radius:8px;margin-bottom:8px;gap:10px}
.dish-item img{width:60px;height:60px;border-radius:4px;object-fit:cover}
.dish-item .info{flex:1}
.dish-item .actions{display:flex;gap:5px}
.dish-item button{padding:5px 8px;font-size:12px;margin:0;border-radius:4px}
.edit-name{background:#4361ee;color:white}
.edit-img{background:#f77f00;color:white}
.delete{background:#d62828;color:white}
/* èœå•æ ·å¼ */
.menu{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px}
.dish{background:white;border-radius:10px;overflow:hidden;box-shadow:0 2px 5px #00000010}
.dish img{width:100%;height:120px;object-fit:cover}
.dish .name{padding:8px;text-align:center}
.dish button{width:100%;background:#ff4d6d;border:none;color:white;padding:6px;border:none;border-radius:0}
/* è®¢å•åŒºåŸŸ */
.orderResult{background:#fff0f3;padding:15px;border-radius:10px;margin-top:20px}
.orderResult strong{color:#e63946}
#orderText{margin:10px 0;padding:8px;background:white;border-radius:4px}
.orderResult button{margin-right:5px;margin-top:5px}
.copy-btn{background:#38b000;color:white}
.clear-btn{background:#808080;color:white}
</style>
</head>
<body>
<div class="container">
  <h1>è€å©†ä¸è‚‰ç‚¹é¤ ğŸ’–</h1>

  <button id="showAdmin">è€å…¬ç®¡ç†åå°</button>

  <!-- ç®¡ç†å‘˜åŒºåŸŸ -->
  <div class="admin" id="admin">
    <!-- èœå“ä¸Šä¼  -->
    <div class="admin-upload">
      <input type="password" id="pwd" placeholder="å¯†ç ï¼ˆé»˜è®¤ï¼šloveyouï¼‰" style="display:none;">
      <input type="text" id="dishName" placeholder="èœå">
      <input type="file" id="dishImg" accept="image/*">
      <button class="admin-btn" onclick="addDish()">æ·»åŠ èœå“</button>
    </div>

    <!-- èœå“ç®¡ç†åˆ—è¡¨ -->
    <div class="admin-list">
      <h3>å·²æ·»åŠ èœå“ï¼ˆå¯ä¿®æ”¹/åˆ é™¤ï¼‰</h3>
      <div id="dishList"></div>
    </div>
  </div>

  <!-- ç‚¹é¤èœå• -->
  <div class="menu" id="menu"></div>

  <!-- è®¢å•åŒºåŸŸ -->
  <div class="orderResult">
    <strong>å½“å‰ç‚¹é¤ï¼š</strong>
    <div id="orderText">è¿˜æ²¡ç‚¹~</div>
    <button class="copy-btn" onclick="copyOrder()">å¤åˆ¶è®¢å•ç»™è€å…¬</button>
    <button class="clear-btn" onclick="clearOrder()">æ¸…ç©ºç‚¹é¤</button>
  </div>
</div>

<script>
// ========== é…ç½®é¡¹ ==========
const ADMIN_PWD = "loveyou" // ç®¡ç†å‘˜å¯†ç ï¼Œå¯è‡ªè¡Œä¿®æ”¹
// åˆå§‹åŒ–æ•°æ®ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰
let dishes = JSON.parse(localStorage.getItem("dishes")) || []
let order = JSON.parse(localStorage.getItem("myOrder")) || []

// ========== ç®¡ç†å‘˜åŠŸèƒ½ ==========
// æ˜¾ç¤º/éšè—ç®¡ç†åå°
document.getElementById("showAdmin").onclick = () => {
  const adminArea = document.getElementById("admin")
  if (adminArea.style.display === "block") {
    adminArea.style.display = "none"
    return
  }
  
  // å¯†ç éªŒè¯
  const inputPwd = prompt("è¯·è¾“å…¥è€å…¬ä¸“å±å¯†ç ï¼š")
  if (inputPwd === ADMIN_PWD) {
    adminArea.style.display = "block"
    renderDishList() // æ˜¾ç¤ºèœå“ç®¡ç†åˆ—è¡¨
  } else if (inputPwd !== null) {
    alert("å¯†ç é”™è¯¯å•¦ï½")
  }
}

// æ·»åŠ æ–°èœå“
function addDish() {
  const nameInput = document.getElementById("dishName")
  const imgInput = document.getElementById("dishImg")
  
  const dishName = nameInput.value.trim()
  const dishFile = imgInput.files[0]
  
  // éªŒè¯è¾“å…¥
  if (!dishName) return alert("èœåä¸èƒ½ä¸ºç©ºå“¦ï½")
  if (!dishFile) return alert("è¯·é€‰æ‹©èœå“å›¾ç‰‡ï½")
  
  // å°†å›¾ç‰‡è½¬ä¸ºBase64æ ¼å¼å­˜å‚¨
  const reader = new FileReader()
  reader.onload = (e) => {
    dishes.push({ 
      name: dishName, 
      img: e.target.result 
    })
    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    localStorage.setItem("dishes", JSON.stringify(dishes))
    
    // é‡ç½®è¡¨å• + åˆ·æ–°åˆ—è¡¨
    nameInput.value = ""
    imgInput.value = ""
    renderMenu()
    renderDishList()
    
    alert(`âœ… èœå“ã€${dishName}ã€‘æ·»åŠ æˆåŠŸï¼`)
  }
  reader.readAsDataURL(dishFile)
}

// æ¸²æŸ“ç®¡ç†å‘˜çš„èœå“ç®¡ç†åˆ—è¡¨ï¼ˆå¸¦ä¿®æ”¹/åˆ é™¤åŠŸèƒ½ï¼‰
function renderDishList() {
  const dishListEl = document.getElementById("dishList")
  if (dishes.length === 0) {
    dishListEl.innerHTML = "<div style='text-align:center; color:#888; padding:10px;'>æš‚æ— èœå“ï¼Œæ·»åŠ ç¬¬ä¸€ä¸ªå§ï½</div>"
    return
  }
  
  dishListEl.innerHTML = ""
  dishes.forEach((dish, index) => {
    const dishItem = document.createElement("div")
    dishItem.className = "dish-item"
    dishItem.innerHTML = `
      <img src="${dish.img}" alt="${dish.name}">
      <div class="info">
        <div>${dish.name}</div>
      </div>
      <div class="actions">
        <button class="edit-name" onclick="editDishName(${index})">æ”¹åå­—</button>
        <button class="edit-img" onclick="editDishImg(${index})">æ¢å›¾ç‰‡</button>
        <button class="delete" onclick="deleteDish(${index})">åˆ é™¤</button>
      </div>
    `
    dishListEl.appendChild(dishItem)
  })
}

// ä¿®æ”¹èœå“åç§°
function editDishName(index) {
  const currentName = dishes[index].name
  const newName = prompt(`ä¿®æ”¹ã€${currentName}ã€‘çš„åç§°ï¼š`, currentName)
  
  if (newName === null) return // å–æ¶ˆæ“ä½œ
  if (newName.trim() === "") return alert("èœåä¸èƒ½ä¸ºç©ºï½")
  
  dishes[index].name = newName.trim()
  localStorage.setItem("dishes", JSON.stringify(dishes))
  renderMenu()
  renderDishList()
  alert(`âœ… èœå“åç§°å·²æ”¹ä¸ºã€${newName}ã€‘ï¼`)
}

// æ›´æ¢èœå“å›¾ç‰‡
function editDishImg(index) {
  const dishName = dishes[index].name
  // åˆ›å»ºä¸´æ—¶æ–‡ä»¶è¾“å…¥æ¡†
  const input = document.createElement("input")
  input.type = "file"
  input.accept = "image/*"
  
  input.onchange = (e) => {
    const file = e.target.files[0]
    if (!file) return
    
    const reader = new FileReader()
    reader.onload = (e) => {
      dishes[index].img = e.target.result
      localStorage.setItem("dishes", JSON.stringify(dishes))
      renderMenu()
      renderDishList()
      alert(`âœ… ã€${dishName}ã€‘çš„å›¾ç‰‡å·²æ›´æ¢ï¼`)
    }
    reader.readAsDataURL(file)
  }
  
  // è§¦å‘æ–‡ä»¶é€‰æ‹©
  input.click()
}

// åˆ é™¤èœå“
function deleteDish(index) {
  const dishName = dishes[index].name
  const confirmDelete = confirm(`ç¡®å®šè¦åˆ é™¤èœå“ã€${dishName}ã€‘å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤å“¦ï½`)
  
  if (!confirmDelete) return
  
  // åˆ é™¤å¹¶ä¿å­˜
  dishes.splice(index, 1)
  localStorage.setItem("dishes", JSON.stringify(dishes))
  renderMenu()
  renderDishList()
  alert(`âŒ èœå“ã€${dishName}ã€‘å·²åˆ é™¤ï¼`)
}

// ========== ç‚¹é¤åŠŸèƒ½ ==========
// æ¸²æŸ“ç‚¹é¤èœå•ï¼ˆè€å©†çœ‹åˆ°çš„ï¼‰
function renderMenu() {
  const menuEl = document.getElementById("menu")
  if (dishes.length === 0) {
    menuEl.innerHTML = "<div style='text-align:center; width:100%; padding:50px; color:#888;'>è€å…¬è¿˜æ²¡æ·»åŠ èœå“å“¦ï½</div>"
    renderOrder()
    return
  }
  
  menuEl.innerHTML = ""
  dishes.forEach((dish, index) => {
    const dishCard = document.createElement("div")
    dishCard.className = "dish"
    dishCard.innerHTML = `
      <img src="${dish.img}" alt="${dish.name}">
      <div class="name">${dish.name}</div>
      <button onclick="choose(${index})">æˆ‘è¦ç‚¹è¿™ä¸ªğŸ˜‹</button>
    `
    menuEl.appendChild(dishCard)
  })
  renderOrder()
}

// é€‰æ‹©èœå“ï¼ˆç‚¹é¤ï¼‰
function choose(index) {
  const dishName = dishes[index].name
  order.push(dishName)
  localStorage.setItem("myOrder", JSON.stringify(order))
  renderOrder()
  alert(`âœ… å·²ç‚¹ã€${dishName}ã€‘ï¼`)
}

// æ¸²æŸ“è®¢å•æ–‡æœ¬
function renderOrder() {
  const orderTextEl = document.getElementById("orderText")
  if (order.length === 0) {
    orderTextEl.textContent = "è¿˜æ²¡ç‚¹ï½å¿«æ¥é€‰å¥½åƒçš„ğŸ˜œ"
    return
  }
  orderTextEl.textContent = order.join("ã€")
}

// å¤åˆ¶è®¢å•
function copyOrder() {
  if (order.length === 0) {
    return alert("è¿˜æ²¡ç‚¹é¤å“¦ï½å…ˆé€‰ç‚¹å¥½åƒçš„å§ï½")
  }
  
  const orderText = "è€å©†ç‚¹é¤ï¼š" + order.join("ã€")
  // å¤åˆ¶åˆ°å‰ªè´´æ¿
  navigator.clipboard.writeText(orderText).then(() => {
    alert("âœ… è®¢å•å·²å¤åˆ¶ï¼å¿«å»å‘ç»™è€å…¬å§ï½")
  }).catch(() => {
    // å¤‡ç”¨æ–¹æ¡ˆï¼šæ‰‹åŠ¨é€‰ä¸­æ–‡æœ¬
    const orderTextEl = document.getElementById("orderText")
    const range = document.createRange()
    range.selectNode(orderTextEl)
    window.getSelection().removeAllRanges()
    window.getSelection().addRange(range)
    alert("å¤åˆ¶å¤±è´¥ï¼Œå·²å¸®ä½ é€‰ä¸­è®¢å•æ–‡æœ¬ï¼Œæ‰‹åŠ¨å¤åˆ¶ä¸€ä¸‹å§ï½")
  })
}

// æ¸…ç©ºè®¢å•
function clearOrder() {
  order = []
  localStorage.setItem("myOrder", JSON.stringify(order))
  renderOrder()
  alert("âœ… ç‚¹é¤è½¦å·²æ¸…ç©ºï¼")
}

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
window.onload = () => {
  renderMenu()
}
</script>
</body>

</html>
