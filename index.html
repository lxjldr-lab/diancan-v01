<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è€å©†ä¸“å±ç‚¹é¤ ğŸ’–</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#fff9fb;padding:15px;font-family:Arial,sans-serif}
.container{max-width:500px;margin:0 auto}
h1{text-align:center;color:#e63946;margin-bottom:20px}

/* ç®¡ç†å‘˜æŒ‰é’® */
#adminBtn{
  background:#7209b7;color:white;border:none;
  padding:10px;width:100%;border-radius:8px;margin-bottom:15px
}

/* ç®¡ç†é¢æ¿ */
.admin{
  background:#f8f0f3;padding:15px;border-radius:10px;margin-bottom:20px;display:none
}
.admin input, .admin button{
  width:100%;padding:10px;margin:5px 0;border-radius:8px;border:1px solid #ddd
}
.addBtn{background:#e63946;color:white}

/* èœå“ç®¡ç†åˆ—è¡¨ */
.manageItem{
  display:flex;align-items:center;background:white;padding:10px;border-radius:8px;margin:8px 0;gap:10px
}
.manageItem img{width:50px;height:50px;border-radius:4px;object-fit:cover}
.manageItem .info{flex:1}
.manageItem button{padding:5px;font-size:12px;border-radius:4px}
.edit{background:#4361ee;color:white}
.del{background:#d62828;color:white}

/* ç‚¹é¤èœå• */
.menu{
  display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px
}
.dish{
  background:white;border-radius:10px;overflow:hidden;
  box-shadow:0 2px 5px #00000010
}
.dish img{width:100%;height:120px;object-fit:cover}
.dish .name{padding:8px;text-align:center}
.dish .order{
  background:#ff4d6d;color:white;border:none;width:100%;padding:6px
}

/* è®¢å• */
.orderBox{
  background:#fff0f3;padding:15px;border-radius:10px;margin-top:20px
}
#orderList{margin:10px 0;padding:10px;background:white;border-radius:8px}
</style>
</head>
<body>

<div class="container">
  <h1>è€å©†å¤§äººç‚¹é¤ ğŸ’–</h1>
  <button id="adminBtn">è€å…¬ç®¡ç†åå°</button>

  <!-- ç®¡ç†åå° -->
  <div class="admin" id="admin">
    <input type="text" id="dishName" placeholder="èœå">
    <input type="file" id="dishImg" accept="image/*">
    <button class="addBtn" onclick="addDish()">æ·»åŠ èœå“</button>
    <div id="manageList"></div>
  </div>

  <!-- ç‚¹é¤èœå• -->
  <div class="menu" id="menu"></div>

  <!-- ç‚¹é¤ç»“æœ -->
  <div class="orderBox">
    <strong>è€å©†ç‚¹äº†ï¼š</strong>
    <div id="orderList"></div>
    <button onclick="submitOrder()">æäº¤ç‚¹é¤</button>
    <button onclick="clearOrder()">æ¸…ç©º</button>
  </div>
</div>

<script>
// ========= æ ¸å¿ƒï¼šç”¨ GitHub Gist åšäº‘ç«¯åŒæ­¥ =========
const GIST_ID = "ä½ çš„GistID"
const GIST_FILE = "dishes.json"
const TOKEN = "ä½ çš„Token"

let dishes = []
let order = []

// ========= èœå“åŒæ­¥ =========
async function loadDishes() {
  try {
    let res = await fetch(`https://api.github.com/gists/${GIST_ID}`)
    let data = await res.json()
    dishes = JSON.parse(data.files[GIST_FILE].content) || []
  } catch (e) {
    dishes = []
  }
  renderMenu()
  renderManage()
}

async function saveDishes() {
  await fetch(`https://api.github.com/gists/${GIST_ID}`, {
    method: "PATCH",
    headers: {
      "Authorization": `token ${TOKEN}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      files: {
        [GIST_FILE]: {
          content: JSON.stringify(dishes)
        }
      }
    })
  })
}

// ========= ç®¡ç†åŠŸèƒ½ =========
document.getElementById("adminBtn").onclick = () => {
  let p = prompt("è€å…¬å¯†ç ï¼š")
  if (p === "loveyou") {
    document.getElementById("admin").style.display = "block"
    loadDishes()
  }
}

async function addDish() {
  let name = document.getElementById("dishName").value
  let file = document.getElementById("dishImg").files[0]
  if (!name || !file) return alert("å¡«å…¨ï¼")

  let reader = new FileReader()
  reader.onload = async e => {
    dishes.push({ name, img: e.target.result })
    await saveDishes()
    loadDishes()
    alert("æ·»åŠ æˆåŠŸï¼")
  }
  reader.readAsDataURL(file)
}

async function editDish(i) {
  let newName = prompt("æ–°åç§°ï¼š", dishes[i].name)
  if (newName) {
    dishes[i].name = newName
    await saveDishes()
    loadDishes()
  }
}

async function delDish(i) {
  if (confirm("ç¡®å®šåˆ é™¤ï¼Ÿ")) {
    dishes.splice(i, 1)
    await saveDishes()
    loadDishes()
  }
}

// ========= ç‚¹é¤ =========
function orderDish(i) {
  order.push(dishes[i].name)
  renderOrder()
}

function renderOrder() {
  document.getElementById("orderList").innerText = order.join("ã€")
}

function submitOrder() {
  if (order.length === 0) return alert("è¿˜æ²¡ç‚¹ï½")
  alert("ç‚¹é¤æˆåŠŸï¼\n" + order.join("ã€"))
}

function clearOrder() {
  order = []
  renderOrder()
}

// ========= ç•Œé¢æ¸²æŸ“ =========
function renderMenu() {
  let m = document.getElementById("menu")
  m.innerHTML = ""
  dishes.forEach((d, i) => {
    m.innerHTML += `
      <div class="dish">
        <img src="${d.img}">
        <div class="name">${d.name}</div>
        <button class="order" onclick="orderDish(${i})">æˆ‘è¦ç‚¹</button>
      </div>
    `
  })
}

function renderManage() {
  let ml = document.getElementById("manageList")
  ml.innerHTML = ""
  dishes.forEach((d, i) => {
    ml.innerHTML += `
      <div class="manageItem">
        <img src="${d.img}">
        <div class="info">${d.name}</div>
        <button class="edit" onclick="editDish(${i})">æ”¹</button>
        <button class="del" onclick="delDish(${i})">åˆ </button>
      </div>
    `
  })
}

// å¯åŠ¨
loadDishes()
</script>
</body>
</html>
